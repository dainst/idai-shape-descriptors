import * as tf from '@tensorflow/tfjs';
import { setDescriptorScaleInvariant } from
    '../../../src/shape_descriptors/fourier_descriptors/fourier_descriptors_phase';

describe('Test setDescriptorScaleInvariant', () => {

    let scaleInvariantdescriptor: tf.Tensor;
    beforeAll(() => {
        scaleInvariantdescriptor = setDescriptorScaleInvariant(tf.complex(InputReal,InputImag));
    });

    it('Should return correct scale invariant descriptor', () => {
        const decimals = 6;
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        const descriptorsRoundedString = Array.from(scaleInvariantdescriptor.dataSync()).map((value: any) =>
                                                                                        value.toFixed(decimals));
        
        expect(descriptorsRoundedString).toEqual(expectedDescriptor.map(val => val.toFixed(decimals)));
                                                                              
    });
});

const InputReal = [
    0.0,
    -0.7913067910164141,
    0.05728728177393892,
    0.008034366181644709,
    0.11914553056071757,
    0.017648062451734284,
    -0.050615492978318924,
    -0.0017392182607149861,
    -0.007352293055521988,
    -0.007843805365706393,
    0.01106128360749102,
    0.0012230399740870506,
    0.013177265566688088,
    -0.007886969223793913,
    -0.002489602073034379,
    -0.0009037539774092999,
    -0.004717558332953404,
    0.003795469908311972,
    0.0003810295484959167,
    -0.00043434893851089886,
    0.00464202195952329,
    3.955231754720354e-06,
    -0.002900871979141413,
    -0.004644555728777422,
    0.0033242984440345173,
    0.0005231282935366059,
    0.0004163561696871309,
    0.0002880620031326408,
    0.0002466389309896398,
    0.0008138003880262855,
    -0.001942270907311999,
    0.00011900303521733562,
    -0.0017893127188234777,
    0.0018335435842491718,
    0.0010368621920673695,
    0.00015558659760263815,
    -0.0007284328454447283,
    1.7520688310645977e-06,
    -0.00014416589606655028,
    -0.0010517405953462042,
    0.0005301339178996805,
    -0.0005987765597007481,
    -0.00016301058126768554,
    -0.00016589351118683046,
    1.670715068622695e-05,
    -4.545350311743896e-05,
    -0.00021335435506042715,
    0.0021502334910539376,
    0.0001630713889937142,
    -0.0017664657144995182,
    -0.0014211908559683176,
    0.0009660715672401554,
    -0.00047080594098522645,
    0.0012934485518530038,
    -0.00010925504335622598,
    0.002047035412254335,
    -0.0012392498840614148,
    -0.0012652435250455952,
    -3.714206394467194e-05,
    -0.003837300126186849,
    0.003853791214455854,
    0.0012867752513746583,
    0.00042735959113705336,
    0.001902563508674188,
    7.144572716489758e-05,
    -0.0035712514992589962,
    -0.010823730895017208,
    0.009059717276350457,
    0.004042130875909436,
    0.0006669687248437974,
    0.004409925774865579,
    -0.006850904838653222,
    0.0172678762279795,
    -0.035147739543729496,
    -0.0012652023362194488,
    -0.028025664418955726,
    0.06706429322935314,
    0.10360868078249509,
    -0.03357230593044369,
    -0.31352828857717024,
    -0.12122087099956114,
];

const InputImag = [
    0.0,
    -2.3645118503206075,
    0.0005015357711004523,
    -0.02978098259969609,
    -0.13171553084601184,
    -0.009075359254989835,
    0.025253896605763174,
    0.05543757754884252,
    -0.023662792903243197,
    0.013237306592181992,
    -0.005540051680636726,
    0.007731578054062487,
    0.00879468362186931,
    -0.002330675109989145,
    0.0036551362831642193,
    0.00272584151040681,
    0.004416230263275648,
    -0.007238459488054433,
    -0.004133537459329287,
    -0.0035999023538330673,
    0.0011734212673716869,
    -0.0012147763315723818,
    -0.0013038482097459695,
    0.0015051206557174619,
    -0.0009584690486692305,
    -0.00033295508228994343,
    -0.00035435782451751684,
    -0.0003805416047118438,
    0.0033818723227957326,
    -0.0006810840998878659,
    0.0018228164599886575,
    0.0015513778383049025,
    -0.0004885821937925561,
    -0.00014959904799723007,
    -0.0011433523035217585,
    -0.00034641625278823934,
    0.0006164507205414957,
    -0.0001361166193462497,
    -0.0004254967423372531,
    -0.0012507111050575064,
    0.00025447731750136935,
    1.6066043802123514e-05,
    0.00023256239344705783,
    0.0004846134469029331,
    -0.0018042208875778372,
    -0.0004767513657390396,
    -0.0005930460613364671,
    -0.0010546826106408581,
    -0.00029884810480066933,
    0.0001688912327736369,
    0.0024936866647484583,
    -0.001677844491137268,
    0.0004508221118501609,
    -1.5889209270479102e-05,
    0.0005323332884385563,
    0.0031007571174451218,
    -0.0013998046542908753,
    0.0025182891244965927,
    0.0016986839512707537,
    0.0015051730135793005,
    -0.003281777614431821,
    -0.0038479215055301926,
    -0.0033847276491859885,
    0.003432099960453848,
    -0.0018013296554867833,
    -0.00347886781724257,
    -0.0023765688687516543,
    0.000825260037404744,
    -0.0012560381122247684,
    -0.007617871226820449,
    -0.0034022735329499935,
    0.02488879384645178,
    0.005644145599775628,
    0.013572882355637507,
    0.0369386717842723,
    -0.03329292038015631,
    0.02730889573463626,
    -0.05131776756349504,
    0.014896680069313134,
    0.05866373538137426,
    0.11904678733856805,
];

const expectedDescriptor = [
    0.0,
    0.0,
    -0.3951910634304354,
    -1.1808744259881936,
    0.028610169990076973,
    0.00025047485625013404,
    0.004012488899830304,
    -0.014873091343573546,
    0.0595031528350636,
    -0.06578080877895562,
    0.008813720098154622,
    -0.0045323772217168825,
    -0.025278173678333404,
    0.012612193360017296,
    -0.0008685929677246135,
    0.0276863985931341,
    -0.003671850847547787,
    -0.01181757113338468,
    -0.0039173198296873525,
    0.006610919214278046,
    0.005524179093844456,
    -0.0027667889875154427,
    0.0006108054088055562,
    0.003861271744244378,
    0.006580933781341331,
    0.004392203393827151,
    -0.003938876539642359,
    -0.001163975825412007,
    -0.0012433464516301165,
    0.0018254325770052364,
    -0.00045134895778299773,
    0.0013613281441156575,
    -0.002356022866934167,
    0.00220553488724119,
    0.0018955173976927392,
    -0.003615000572670454,
    0.00019029215239654945,
    -0.0020643536524988532,
    -0.00021692069480349293,
    -0.0017978478835366236,
    0.0023182988134034478,
    0.0005860250458723627,
    1.975304977800122e-06,
    -0.0006066784156971234,
    -0.0014487411144796646,
    -0.0006511623132913197,
    -0.002319564217640332,
    0.0007516809400309567,
    0.0016602069540824803,
    -0.00047867452536609655,
    0.00026125850173449596,
    -0.00016628300747390085,
    0.00020793482291884817,
    -0.00017697187373571808,
    0.0001438626973056375,
    -0.00019004846559250426,
    0.00012317536324431684,
    0.0016889602551178908,
    0.0004064247197362137,
    -0.0003401441170175215,
    -0.0009700006546698572,
    0.0009103432239424276,
    5.943198841827316e-05,
    0.0007747825049177508,
    -0.0008936109283899548,
    -0.00024400563590518988,
    0.0009157005186000634,
    -7.471211865914565e-05,
    0.0005178252947729555,
    -0.0005710081321607527,
    7.770239515211538e-05,
    -0.00017300572784561267,
    -0.0003637908256280703,
    0.00030786519030164434,
    8.750107447736736e-07,
    -6.797878163146508e-05,
    -7.199871708893224e-05,
    -0.0002124997687362916,
    -0.0005252558034968312,
    -0.0006246248070448802,
    0.00026475722078186,
    0.0001270899768130571,
    -0.0002990384362573324,
    8.023635089907178e-06,
    -8.141004941818297e-05,
    0.00011614531888727805,
    -8.284982998556429e-05,
    0.00024202358125634534,
    8.343813956280833e-06,
    -0.0009010563024606969,
    -2.2700194712782023e-05,
    -0.00023809713420545555,
    -0.00010655252225946832,
    -0.0002961765351991377,
    0.0010738604414880053,
    -0.0005267250922305086,
    8.144041775343154e-05,
    -0.00014924944620865377,
    -0.0008822007749103065,
    8.434693931813646e-05,
    -0.0007097650773176292,
    0.0012453863610072278,
    0.0004824713427735831,
    -0.0008379419414203923,
    -0.0002351278955262486,
    0.00022514765679083396,
    0.0006459685604906458,
    -7.935321142137295e-06,
    -5.4563687888519156e-05,
    0.00026585562103825035,
    0.001022321697011406,
    0.001548566897939349,
    -0.0006189008929257572,
    -0.0006990844716668294,
    -0.0006318825262689673,
    0.0012576732165495406,
    -1.8549331201167042e-05,
    0.00084834949574062,
    -0.0019164080667394003,
    0.0007517070883710619,
    0.0019246439757245643,
    -0.001638971382671486,
    0.0006426358092207612,
    -0.0019217125507213998,
    0.0002134301047406845,
    -0.0016903862500485761,
    0.0009501701549548519,
    0.0017140447277460267,
    3.568112041549628e-05,
    -0.0008996123756580213,
    -0.001783539195912732,
    -0.0017374013313649055,
    -0.0054055415311076,
    -0.0011868958907217963,
    0.0045245653714423364,
    0.0004121478489647597,
    0.002018703766365771,
    -0.0006272851982499497,
    0.00033309467660109376,
    -0.0038044847654300513,
    0.0022023863265218267,
    -0.0016991489405021958,
    -0.0034214496822028693,
    0.012429855296763314,
    0.008623849115404347,
    0.0028187751287544246,
    -0.017553334212664813,
    0.00677851103116505,
    -0.0006318619559210428,
    0.018447753955686177,
    -0.013996457822440057,
    -0.016627008334958004,
    0.03349296336187877,
    0.013638492262425082,
    0.05174380556808519,
    -0.025628900657157175,
    -0.01676653787518013,
    0.007439636440644062,
    -0.1565809609938836,
    0.029297592581492275,
    -0.06053961050776132,
    0.059453838916099636
];

